From 441b3c22e3391775993c56cc6731a3bffc59b895 Mon Sep 17 00:00:00 2001
From: Marko Lindqvist <cazfi74@gmail.com>
Date: Wed, 15 Sep 2021 16:45:17 +0300
Subject: [PATCH 1975/2135] Autosettlers: Pass action, and not activity, to
 action_speculate_unit_on_tile()

See osdn #42791

Signed-off-by: Marko Lindqvist <cazfi74@gmail.com>
---
 server/advisors/autosettlers.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/server/advisors/autosettlers.c b/server/advisors/autosettlers.c
index 0be0a87a3c..b0eca1ce0c 100644
--- a/server/advisors/autosettlers.c
+++ b/server/advisors/autosettlers.c
@@ -739,11 +739,13 @@ adv_want settler_evaluate_improvements(struct unit *punit,
                   /* Roads handled above already */
                   if (!is_extra_caused_by(pdep, EC_ROAD)) {
                     enum unit_activity eval_dep_act = ACTIVITY_LAST;
+                    action_id eval_dep_action;
 
                     as_extra_action_iterate(try_act) {
                       struct action *taction = action_by_number(try_act);
 
                       if (is_extra_caused_by_action(pdep, taction)) {
+                        eval_dep_action = try_act;
                         eval_dep_act = action_id_get_activity(try_act);
                         break;
                       }
@@ -751,7 +753,7 @@ adv_want settler_evaluate_improvements(struct unit *punit,
 
                     if (eval_dep_act != ACTIVITY_LAST) {
                       if (action_prob_possible(
-                            action_speculate_unit_on_tile(eval_dep_act,
+                            action_speculate_unit_on_tile(eval_dep_action,
                                                           punit, unit_home(punit), ptile,
                                                           parameter.omniscience,
                                                           ptile, pdep))) {
-- 
2.30.2

